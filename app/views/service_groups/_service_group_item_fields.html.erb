<div class="nested-fields border p-3 mb-3">
    <div class="row">
        <!-- Peça/Serviço -->
        <div class="col-12 col-md-4 mb-2">
            <%= f.association :service, 
                label: 'Peça/Serviço',
                collection: Service.all.order("category_id ASC, name ASC"),
                label_method: :getting_formatted_name_with_type_and_price,
                value_method: :id,
                include_blank: 'Selecione...',
                input_html: { class: 'form-select select2' } %>
        </div>

        <!-- Quantidade Limite -->
        <div class="col-12 col-md-3 mb-2">
            <%= f.input :quantity, 
                label: 'Quantidade Limite',
                as: :integer,
                input_html: { class: 'form-control', placeholder: '1', min: 1, step: 1 } %>
        </div>

        <!-- Valor Máximo -->
        <div class="col-12 col-md-3 mb-2">
            <% 
              # Formatar valor para exibição no formato brasileiro
              formatted_value = if f.object.max_value.present? && f.object.max_value.to_f > 0
                ActionController::Base.helpers.number_to_currency(f.object.max_value, unit: "R$ ", separator: ",", delimiter: ".")
              else
                ""
              end
            %>
            <%= f.input :max_value, 
                label: 'Valor Máximo (R$)',
                as: :string,
                input_html: { class: 'money', placeholder: '0,00', value: formatted_value } %>
        </div>

        <!-- Remover -->
        <div class="col-12 col-md-2 mb-2 d-flex align-items-end">
            <% if f.object.persisted? %>
                <%= f.input :_destroy, as: :hidden %>
                <button type="button" class="btn btn-sm btn-danger w-100 remove-item">Remover</button>
            <% else %>
                <button type="button" class="btn btn-sm btn-danger w-100 remove-item">Remover</button>
            <% end %>
        </div>
    </div>
</div>
