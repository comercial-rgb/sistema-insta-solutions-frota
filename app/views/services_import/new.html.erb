<%
breadcrumbs = [
  {active: false, href: root_path, text: t('menu.initial_page')},
  {active: false, href: services_path, text: Service.model_name.human(count: 2)},
  {active: true, href: '#', text: 'Importação em Massa'},
]
%>

<div class="container-fluid">
  <%= render 'common_pages/breadcrumb', links: breadcrumbs %>

  <div class="row mb-4">
    <div class="col-12">
      <h3>
        <i class="bi bi-upload"></i>
        Importação em Massa de Peças e Serviços
      </h3>
      <p class="text-muted">Importe várias peças e serviços de uma única vez usando um arquivo CSV</p>
    </div>
  </div>

  <!-- Card de Instruções -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card border-info">
        <div class="card-header bg-info text-white">
          <h5 class="mb-0">
            <i class="bi bi-info-circle"></i>
            Como Funcionar
          </h5>
        </div>
        <div class="card-body">
          <ol class="mb-0">
            <li class="mb-2">
              <strong>Baixe o template CSV:</strong>
              <%= link_to template_services_import_path, class: 'btn btn-sm btn-outline-primary' do %>
                <i class="bi bi-download"></i> Download Template
              <% end %>
            </li>
            <li class="mb-2">
              <strong>Preencha o arquivo:</strong> Abra com Excel ou LibreOffice e adicione seus dados
            </li>
            <li class="mb-2">
              <strong>Salve como CSV:</strong> Arquivo → Salvar Como → CSV (separado por vírgula)
            </li>
            <li>
              <strong>Faça o upload:</strong> Use o formulário abaixo
            </li>
          </ol>
          
          <hr>
          
          <h6><i class="bi bi-table"></i> Estrutura do Arquivo CSV:</h6>
          <table class="table table-sm table-bordered">
            <thead class="table-light">
              <tr>
                <th>Coluna</th>
                <th>Descrição</th>
                <th>Obrigatório</th>
                <th>Exemplo</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>nome</code></td>
                <td>Nome da peça/serviço</td>
                <td><span class="badge bg-danger">Sim</span></td>
                <td>Filtro de Óleo</td>
              </tr>
              <tr>
                <td><code>categoria</code></td>
                <td>Tipo: "peca" ou "servico"</td>
                <td><span class="badge bg-danger">Sim</span></td>
                <td>peca</td>
              </tr>
              <tr>
                <td><code>codigo</code></td>
                <td>Código/SKU do item</td>
                <td><span class="badge bg-secondary">Não</span></td>
                <td>FO-001</td>
              </tr>
              <tr>
                <td><code>preco</code></td>
                <td>Preço unitário (use . ou , para decimal)</td>
                <td><span class="badge bg-secondary">Não</span></td>
                <td>45.50</td>
              </tr>
              <tr>
                <td><code>descricao</code></td>
                <td>Descrição detalhada</td>
                <td><span class="badge bg-secondary">Não</span></td>
                <td>Filtro de óleo lubrificante</td>
              </tr>
              <tr>
                <td><code>marca</code></td>
                <td>Marca/Fabricante</td>
                <td><span class="badge bg-secondary">Não</span></td>
                <td>Mann</td>
              </tr>
              <tr>
                <td><code>periodo_garantia</code></td>
                <td>Período de garantia em dias</td>
                <td><span class="badge bg-secondary">Não</span></td>
                <td>90</td>
              </tr>
              <tr>
                <td><code>fornecedor_id</code></td>
                <td>ID do fornecedor (deixe vazio para usar seu usuário)</td>
                <td><span class="badge bg-secondary">Não</span></td>
                <td>123</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Formulário de Upload -->
  <div class="row">
    <div class="col-lg-8 offset-lg-2">
      <div class="card">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">
            <i class="bi bi-file-earmark-arrow-up"></i>
            Upload do Arquivo CSV
          </h5>
        </div>
        <div class="card-body">
          <%= form_with url: services_import_path, method: :post, multipart: true, local: true do |f| %>
            <div class="mb-4">
              <label class="form-label fw-bold">Selecione o arquivo CSV:</label>
              <%= f.file_field :file, 
                accept: '.csv,.xlsx,.xls', 
                class: 'form-control form-control-lg',
                required: true %>
              <div class="form-text">
                <i class="bi bi-info-circle"></i>
                Formatos aceitos: CSV (.csv)
              </div>
            </div>

            <div class="alert alert-warning">
              <i class="bi bi-exclamation-triangle"></i>
              <strong>Atenção:</strong>
              <ul class="mb-0 mt-2">
                <li>Itens com o <strong>mesmo nome</strong> serão <strong>atualizados</strong></li>
                <li>Itens novos serão <strong>criados</strong></li>
                <li>Revise o arquivo antes de enviar</li>
              </ul>
            </div>

            <div class="d-grid gap-2">
              <%= f.submit 'Importar Peças e Serviços', class: 'btn btn-primary btn-lg' %>
              <%= link_to 'Cancelar', services_path, class: 'btn btn-secondary' %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <!-- Card de Exemplos -->
  <div class="row mt-4">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="bi bi-code-square"></i>
            Exemplo de Arquivo CSV
          </h5>
        </div>
        <div class="card-body">
          <pre class="mb-0 bg-light p-3 rounded"><code>nome;categoria;codigo;preco;descricao;marca;periodo_garantia;fornecedor_id
Filtro de Óleo;peca;FO-001;45.50;Filtro de óleo lubrificante;Mann;30;
Filtro de Ar;peca;FA-001;38.90;Filtro de ar motor;Tecfil;30;
Pastilha de Freio Dianteira;peca;PF-001;89.00;Pastilha de freio jogo dianteiro;Bosch;90;
Mão de Obra Troca de Óleo;servico;MO-001;50.00;Serviço de troca de óleo;;;30;
Alinhamento e Balanceamento;servico;AB-001;80.00;Serviço de alinhamento e balanceamento;;;30;</code></pre>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.card-header.bg-info,
.card-header.bg-primary {
  font-weight: 500;
}

pre code {
  font-size: 0.85rem;
  color: #333;
}

.form-control-lg {
  padding: 0.75rem 1rem;
}
</style>
